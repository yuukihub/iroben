<!DOCTYPE html>
<html>
<head>
  <!-- This file is the template for "www/index.html". Modify it to fit your needs -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <link rel="stylesheet" href="./css/common.css">
    <title>iroben</title>
</head>
<body>

    <canvas id="myCanvas"></canvas>
    <div id="app" style="display:none;"></div>

    <!-- three.jsを読み込む -->
    <script src="https://unpkg.com/three@0.147.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.147.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.142.0/examples/js/loaders/GLTFLoader.js"></script>

    <script type="module" src="./main.js"></script>
    <script src="components/loader.js"></script>
    <link rel="stylesheet" href="components/loader.css" />

    <script>
        window.addEventListener("DOMContentLoaded", init);
        function init() {
            // レンダラーを作成
            const canvasElement = document.querySelector('#myCanvas');
            const renderer = new THREE.WebGLRenderer({
                antialias: true,
                canvas: canvasElement,
            });

            // サイズ指定
            const width = 745;
            const height = 540;
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(width, height);

            // シーンを作成
            const scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x87B8C0 );

            // 環境光源を作成
            const ambientLight = new THREE.AmbientLight(0xffffff);
            ambientLight.intensity = 2;
            scene.add(ambientLight);

            // 平行光源を作成
            const directionalLight = new THREE.DirectionalLight(0xffffff);
            directionalLight.intensity = 2;
            directionalLight.position.set(0, 3, 6); //x,y,zの位置を指定
            scene.add(directionalLight);

            // カメラを作成
            const camera = new THREE.PerspectiveCamera(45, width / height, 1, 10000);
            camera.position.set(0, 0, 1500);

            // カメラコントローラーを作成
            const controls = new THREE.OrbitControls(camera, canvasElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.2;

            // 3Dモデルの読み込み
            const loader = new THREE.GLTFLoader();
            let model = null;
            loader.load(
                //3Dモデルファイルのパスを指定
                'assets/bed1.glb',
                function (glb) {
                    model = glb.scene;
                    model.name = "model_castle";
                    model.scale.set(80.0, 80.0, 80.0);
                    model.position.set(0,-200,0);
                    scene.add( glb.scene );
                },
                function (error) {
                    console.log(error);
                }
            );

            // リアルタイムレンダリング
            tick();
            function tick() {
                controls.update();
                renderer.render(scene, camera);
                requestAnimationFrame(tick);
            }
        }
    </script>
</body>
</html>
